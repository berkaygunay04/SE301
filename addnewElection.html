<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
      <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/vote.png" />
    <title>I-Voted Admin</title>
	<!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
     <!-- FONTAWESOME STYLES-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
        <!-- CUSTOM STYLES-->
    <link href="assets/css/custom.css" rel="stylesheet" />
     <!-- GOOGLE FONTS-->
   <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
   <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
   <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>
<style>
.textareaStyle{
  width: 50%;
  height: 80px;
  margin-top: 5px;
}
.addButton{
  width: 180px;
  text-align: center;
  margin-top: 10px;
  background-color: #74ced3;
}

.addButton:hover{
  background-color: #a2eaee;
}
.selectCategory{
  width: 30%;
  height: 35px;
}
</style>
<body>


<form id="formAdminMain">
  <div id="wrapper">
       <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="adjust-nav">
              <div class="navbar-header">
                  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="#">
                      <img src="assets/img/vote.png" />

                  </a>

              </div>
          </div>
      </div>
      <!-- /. NAV TOP  -->
      <nav class="navbar-default navbar-side" role="navigation">
          <div class="sidebar-collapse">
              <ul class="nav" id="main-menu">



                  <li>
                      <a href="mainElections.html" ><i class="fa fa-desktop "></i>Dashboard <span id="spanID3" class="badge" style="background-color:red"></span></a>
                  </li>
                  <li>
                     <a href="allUsers.html"><i class="fa fa-users "></i>Users<span id="spanID98" class="badge" style="background-color:red"></span></a>
                 </li>
                 <li>
                    <a href="allElections.html"><i class="fa fa-edit "></i>User Elections</a>
                </li>
                <li>
                   <a href="myElections.html"><i class="fa fa-folder-open "></i>My Elections</a>
               </li>
                   <li>
                      <a href="changePassword.html"><i class="fa fa-lock "></i>Change Password</a>
                  </li>


                  <li>
                     <a onclick="logout1()" href="#"><i class="fa fa-power-off "></i>Logout</a>
                 </li>



              </ul>
            </div>

      </nav>
      <!-- /. NAV SIDE  -->
      <div id="page-wrapper" >
          <div id="page-inner">
              <div class="row">
                  <div class="col-lg-12">
                   <h2>ADD ELECTION</h2>
                  </div>
              </div>
               <!-- /. ROW  -->
                <hr />
              <div class="row">
                  <div class="col-lg-12 ">
                      <div class="alert alert-info">

                           <strong> You must all input box full for adding. </strong>
                      </div>

                  </div>
                  </div>

                  <div>
                    <select class="selectCategory" id="CategorySelect">
                      <option value="Category" disabled selected>Select Category</option>
                      <option value="Art">Art</option>
                      <option value="Cinema">Cinema</option>
                      <option value="Culture">Culture</option>
                      <option value="History">History</option>
                      <option value="Science">Science</option>
                      <option value="Sport">Sport</option>
                    </select><br>
                    <label for="start">Finish date:</label>
                    <input type="date" id="finishID" name="trip-start"><br>
                    <input id="electionName" placeholder="Enter Election Name"></input><br>
                    <textarea class="textareaStyle" id="textarea1" placeholder="Your Ouestion"></textarea>
                    <br>
                    <input id="answer1" placeholder="Enter Answer"></input><br>
                    <input id="answer2" placeholder="Enter Answer"></input><br>
                    <input id="answer3" placeholder="Enter Answer"></input><br>
                    <button type="reset" class="addButton" onclick="addElection()">Add Election</button>
                  </div>

           <!-- /. PAGE INNER  -->
          </div>
       <!-- /. PAGE WRAPPER  -->
      </div>
  <div class="footer">


          <div class="row">
              <div class="col-lg-12" >
                  &copy;  2018 | Design by: <a style="color:#fff;" target="_blank">SE301-Voted Group</a>
              </div>
          </div>
      </div>

</from>


     <!-- /. WRAPPER  -->
    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
    <script src="assets/js/jquery-1.10.2.js"></script>
      <!-- BOOTSTRAP SCRIPTS -->
    <script src="assets/js/bootstrap.min.js"></script>
      <!-- CUSTOM SCRIPTS -->
    <script src="assets/js/custom.js"></script>


<script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDpEfxHmFK0q0lpVFWK7DmpE7vgLLgPhr0",
    authDomain: "vote-a0e5a.firebaseapp.com",
    databaseURL: "https://vote-a0e5a.firebaseio.com",
    projectId: "vote-a0e5a",
    storageBucket: "vote-a0e5a.appspot.com",
    messagingSenderId: "384488603364"
  };
  firebase.initializeApp(config);
</script>

    <script>
    var currentUserID = "";
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in.
        currentUserID = user.uid
        document.getElementById("formAdminLogin").action = "admin.html";
        document.getElementById("formAdminLogin").submit();
      } else {
        // No user is signed in.
        document.getElementById("formAdminMain").action = "login.html";
        document.getElementById("formAdminMain").submit();
      }
    });
    function logout1(){
      firebase.auth().signOut().then(function() {
        console.log('Signed Out');
      }, function(error) {
        console.error('Sign Out Error', error);
      });
    }

    var countPending = 0;
    var badgePending = function(){
      firebase.database().ref("WaitingElections").on("child_added",function(elecSnap1){
        firebase.database().ref("WaitingElections").child(elecSnap1.key).on("child_added",function(elecSnap2){
            countPending += 1;
            document.getElementById("spanID3").innerHTML = countPending
        });
      });
    }
    badgePending();

    countBadgeUser = 0;
    var badgeUser = function(){
      firebase.database().ref("Kullanıcılar").on("child_added",function(snapshot){
        firebase.database().ref("Kullanıcılar").child(snapshot.key).on("value",function(snapshot2){
          var ozgur = snapshot2.val().Free
          if(ozgur == "Dondurmak istiyorum" || ozgur == "Açmak istiyorum"){
            countBadgeUser += 1;
            document.getElementById("spanID98").innerHTML = countBadgeUser
          }
        });
      });

    }
    badgeUser();

    function addElection(){
      var yourQuestion = document.getElementById("textarea1").value
      var answer1 = document.getElementById("answer1").value
      var answer2 = document.getElementById("answer2").value
      var answer3 = document.getElementById("answer3").value
      var electionName = document.getElementById("electionName").value
      var category = document.getElementById("CategorySelect").value;
      var tarih = currentDay();
      var tarih2 = currentTime();
      var tarihSon = tarih + " / " + tarih2;

      var finishDate1 = document.getElementById("finishID").value

      if(calculateDiff(finishDate1) == "false"){
        alert("Please enter the current date.");
      }else if(calculateDiff(finishDate1) == "olmaz"){
        alert("Please select a date within the current year.");
      }else{
        if(yourQuestion == "" || answer1 == "" || answer2 == "" || answer3 == "" || electionName == ""){
           alert("Please fill the blank.");
         }else if(category == "Category"){
           alert("Please Select the Category.");
         }else if(finishDate1 == ""){
           alert("Please select finish date.");
         }else{
           var sonDate = finishDate1.split("-");
           var sonDateTesult = sonDate[2] + "-" + sonDate[1] + "-" + sonDate[0];
           var newPostKey = firebase.database().ref().push().key;
           firebase.database().ref("Elections").child(category).child(newPostKey).set({
             DateType: tarihSon,
             ElectionName: electionName,
             Option1: answer1,
             Option2: answer2,
             Option3: answer3,
             Option1C: 0,
             Option2C: 0,
             Option3C: 0,
             AdminOnay: true,
             Question: yourQuestion,
             Type: "Admin Type",
             VoteCount: 0,
             finishDate: sonDateTesult
           }).then(function(error){
             if(error){
               alert("Upss! Please try again!");
             }else {
               firebase.database().ref("Admin").child(currentUserID).child("Elections").update({[newPostKey] : newPostKey});
               alert("Adding is Success");
             }
           });

           //timedRefresh(1);
           // Database dizaynının tam olarak netleşmesini bekliyorum.
         }
      }



    }

      var d = new Date();
      var year = d.getFullYear();
      var month = d.getMonth();
      var day = d.getDate();
      var c = new Date(year, month, day + 1);
      var month1 = ("0" + (c.getMonth() + 1)).slice(-2); //months from 1-12
      var day1 = ("0" + c.getDate()).slice(-2)
      var year1 = c.getFullYear();
      var newdate = year1 + "-" + month1 + "-" + day1;
      console.log(newdate);



    document.getElementById("finishID").setAttribute("max","2020-12-31");
    document.getElementById("finishID").setAttribute("min",newdate);

    function calculateDiff(gelenDay){
      var day = currentDay();

      var kes1 = day.split("-");
      var currentYear = kes1[0]; // yıl
      var kes2 = kes1[2]; // gün
      var kes3 = kes1[1]; // ay
      console.log("gün : ",kes2);
      console.log("ay : ",kes3);

      var gelen1 = gelenDay.split("-");
      var gelenYil = gelen1[0]; // yil
      var gelen3 = gelen1[1]; // ay
      var gelen2 = gelen1[2]; // gün

      if(currentYear < gelenYil){
        return "olmaz";
      }else if(kes3 > gelen3){
        return "false";
      }else if(kes2 > gelen2 || kes2 == gelen2){
        return "false";
      }else{
        return "true";
      }
      //alert(diffDays);
    }

    function currentTime(){
    var currentdate = new Date();
    var datetime =  currentdate.getHours() + ":"
                    + currentdate.getMinutes() + ":"
                    + currentdate.getSeconds();
    console.log(datetime);
    return datetime;
    }

    function currentDay(){
    var dateObj = new Date();
    var month = ("0" + (dateObj.getMonth() + 1)).slice(-2); //months from 1-12
    var day = ("0" + dateObj.getDate()).slice(-2)
    var year = dateObj.getFullYear();
    return newdate = year + "-" + month + "-" + day;
    }

    function timedRefresh(timeoutPeriod) {
    setTimeout("location.reload(true);",timeoutPeriod); // otomatik refresh.
    }

    </script>




</body>
</html>
