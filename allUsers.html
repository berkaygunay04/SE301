<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
      <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/vote.png" />
    <title>I-Voted Admin</title>
	<!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
     <!-- FONTAWESOME STYLES-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
        <!-- CUSTOM STYLES-->
    <link href="assets/css/custom.css" rel="stylesheet" />
     <!-- GOOGLE FONTS-->
   <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<style>
.btn {
  background-color: red;
  border: none;
  color: white;
  padding: 0px 5px;
  font-size: 20px;
  cursor: pointer;
  margin-right: 5px;
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
}

/* Darker background on mouse-over */
.btn:hover {
  background-color: green;
}

.btn2 {
  background-color: #5ba631;
  border: none;
  border-radius: 5px;
  color: white;
  padding: 4px 12px;
  font-size: 13px;
  cursor: pointer;
  display: block;
  margin: auto;
  margin-top: 2px;
  margin-bottom: 1px;
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
  float: left;
}

/* Darker background on mouse-over */
.btn2:hover {
  background-color: blue;
}

.btn3 {
  background-color: #e7b92d;
  border: none;
  border-radius: 5px;
  color: white;
  padding: 4px 12px;
  font-size: 13px;
  cursor: pointer;
  display: block;
  margin: auto;
  margin-top: 2px;
  margin-bottom: 1px;
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
  float: left;
  margin-left: 5px;
}

/* Darker background on mouse-over */
.btn3:hover {
  background-color: blue;
}

#loader {
position: absolute;
left: 50%;
top: 50%;
z-index: 1;
width: 150px;
height: 150px;
margin: -75px 0 0 -75px;
border: 16px solid #f3f3f3;
border-radius: 50%;
border-top: 16px solid #3498db;
width: 120px;
height: 120px;
-webkit-animation: spin 2s linear infinite;
animation: spin 2s linear infinite;
}

@-webkit-keyframes spin {
0% { -webkit-transform: rotate(0deg); }
100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

/* Add animation to "page content" */
.animate-bottom {
position: relative;
-webkit-animation-name: animatebottom;
-webkit-animation-duration: 1s;
animation-name: animatebottom;
animation-duration: 1s
}

@-webkit-keyframes animatebottom {
from { bottom:-100px; opacity:0 }
to { bottom:0px; opacity:1 }
}

@keyframes animatebottom {
from{ bottom:-100px; opacity:0 }
to{ bottom:0; opacity:1 }
}

#myDiv {
display: none;

}

</style>

<body style="margin:0;">

  <div id="loader"></div>
<div style="display:none;" class="animate-bottom" id="myDiv">
<form id="formAdminMain">
  <div id="wrapper">
       <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="adjust-nav">
              <div class="navbar-header">
                  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="#">
                      <img src="assets/img/vote.png" />

                  </a>

              </div>
          </div>
      </div>
      <!-- /. NAV TOP  -->
      <nav class="navbar-default navbar-side" role="navigation">
          <div class="sidebar-collapse">
              <ul class="nav" id="main-menu">



                  <li>
                      <a href="mainElections.html" ><i class="fa fa-desktop "></i>Dashboard <span id="spanID7"class="badge" style="background-color:red"></span></a>
                  </li>
                  <li class="active-link">
                     <a href="#"><i class="fa fa-users "></i>Users<span id="spanID99"class="badge" style="background-color:red"></span></a>
                 </li>
                 <li>
                    <a href="allElections.html"><i class="fa fa-edit "></i>User Elections</a>
                </li>
                <li>
                   <a href="myElections.html"><i class="fa fa-folder-open "></i>My Elections</a>
               </li>
                   <li>
                      <a href="changePassword.html"><i class="fa fa-lock "></i>Change Password</a>
                  </li>

                  <li>
                     <a onclick="logout1()" href="#"><i class="fa fa-power-off "></i>Logout</a>
                 </li>



              </ul>
            </div>

      </nav>
      <!-- /. NAV SIDE  -->
      <div id="page-wrapper" >
          <div id="page-inner">
              <div class="row">
                  <div class="col-lg-12">
                   <h2>ALL USERS</h2>
                  </div>
              </div>
               <!-- /. ROW  -->
                <hr />
              <div class="row">
                  <div class="col-lg-12 ">
                      <div class="alert alert-info">
                        <!-- WARNING: BURADA DA NOTİFİCATİON DURUMUNU SCRİPT YAZIP,
                      BEKLEYEN ELECTİONLARI SAY VE NOTİFİCATİON OLARAK BELİRT! -->
                           <strong id="strongName"> You can see all the users below. </strong>
                      </div>

                  </div>
                  </div>
                <!-- /. ROW  -->
                <h3 id="thereIsNo" style="display:none;">There is no election.</h3>
              <div class="row text-center pad-top" style="margin-left:15px;margin-right:15px">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h3 id="nameID" style="text-align:left"class="panel-title">Name</h3>
                  </div>
                  <ul style="text-align:left"class="list-group" id="userLists">
              </ul>
            </div>
          </div>
               <!-- /. ROW  -->

           <!-- /. PAGE INNER  -->
          </div>
       <!-- /. PAGE WRAPPER  -->
      </div>
  <div class="footer">


          <div class="row">
              <div class="col-lg-12" >
                  &copy;  2018 | Design by: <a style="color:#fff;" target="_blank">SE301-Voted Group</a>
              </div>
          </div>
      </div>

</from>


     <!-- /. WRAPPER  -->
    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
    <script src="assets/js/jquery-1.10.2.js"></script>
      <!-- BOOTSTRAP SCRIPTS -->
    <script src="assets/js/bootstrap.min.js"></script>
      <!-- CUSTOM SCRIPTS -->
    <script src="assets/js/custom.js"></script>


<script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDpEfxHmFK0q0lpVFWK7DmpE7vgLLgPhr0",
    authDomain: "vote-a0e5a.firebaseapp.com",
    databaseURL: "https://vote-a0e5a.firebaseio.com",
    projectId: "vote-a0e5a",
    storageBucket: "vote-a0e5a.appspot.com",
    messagingSenderId: "384488603364"
  };
  firebase.initializeApp(config);
</script>

    <script>
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in.
        document.getElementById("formAdminLogin").action = "admin.html";
        document.getElementById("formAdminLogin").submit();
      } else {
        // No user is signed in.
        document.getElementById("formAdminMain").action = "login.html";
        document.getElementById("formAdminMain").submit();
      }
    });
    function logout1(){
      firebase.auth().signOut().then(function() {
        console.log('Signed Out');
      }, function(error) {
        console.error('Sign Out Error', error);
      });
    }

    var countPending = 0;
    var badgePending = function(){
      firebase.database().ref("WaitingElections").on("child_added",function(elecSnap1){
        firebase.database().ref("WaitingElections").child(elecSnap1.key).on("child_added",function(elecSnap2){
            countPending += 1;
            document.getElementById("spanID7").innerHTML = countPending

        });
      });
    }
    badgePending();

    countBadgeUser = 0;
    var badgeUser = function(){
      firebase.database().ref("Kullanıcılar").on("child_added",function(snapshot){
        firebase.database().ref("Kullanıcılar").child(snapshot.key).on("value",function(snapshot2){
          var ozgur = snapshot2.val().Free
          if(ozgur == "Dondurmak istiyorum" || ozgur == "Açmak istiyorum"){
            countBadgeUser += 1;
            document.getElementById("spanID99").innerHTML = countBadgeUser
          }
        });
      });

    }
    badgeUser();


    var userCount = 0;
    var toogleID = "";
    var getUsers = function(){
      showLoading();
      const list_div = document.querySelector("#userLists");
      list_div.innerHTML = "";

        firebase.database().ref("Kullanıcılar").on("value",function(snapshotValue){
          var exists = (snapshotValue.val() !== null);
          list_div.innerHTML = "";
          userCount = 0;
          if(exists){
            firebase.database().ref("Kullanıcılar").on("child_added",function(userSnap1){
                firebase.database().ref("Kullanıcılar").child(userSnap1.key).on("value",function(userSnap2){
                    userCount += 1;
                    toogleID = userCount.toString();
                    var userName = userSnap2.val().name + " " + userSnap2.val().surname

                      var frezeee = userSnap2.val().Free
                      console.log(frezeee);

                      if(frezeee == "Dondurmak istiyorum"){
                        list_div.innerHTML += "<li class='list-group-item'><div class='row toggle' id='dropdown-detail' data-toggle='detail'><div onclick='ready(\"" +  toogleID + "\")' style='text-align:left' class='col-xs-10'><b>" + toogleID + "- </b>" + userName.toUpperCase() + "<span id='spanIDUser' class='badge' style='background-color:red'>   User want to be frezee user. Please check!</span></div><div class='col-xs-2'><button onclick='deleteUser(\"" +  userSnap1.key + "\")' class='btn'><i class='fa fa-trash'></i></button><i onclick='ready(\"" +  toogleID + "\")' style='margin-top:7px;margin-right:20px' class='fa fa-chevron-down pull-right'></i></div></div><div style='display: none;' id=\"" +  toogleID + "\"><hr></hr><div class='container'><div style='text-align:left' class='fluid-row'><b>E-mail : </b>" + userSnap2.val().email + "<br><b>Vote Count : </b>" + userSnap2.val().UserVoteCount + "<br><button type='button' class='btn2' onclick='allOneUserElections(\"" +  userSnap1.key + "\")'><i class='fa fa-check'> Ongoing Elections</i></button><button type='button' class='btn3' onclick='makefreeze(\"" +  userSnap1.key + "\")'><i class='fa fa-remove'>  Make Freeze</i></button></div></div></div></li>"

                      }else if(frezeee == "Açmak istiyorum"){
                        list_div.innerHTML += "<li class='list-group-item'><div class='row toggle' id='dropdown-detail' data-toggle='detail'><div onclick='ready(\"" +  toogleID + "\")' style='text-align:left' class='col-xs-10'><b>" + toogleID + "- </b>" + userName.toUpperCase() + "<span id='spanIDUser' class='badge' style='background-color:red'>   User want to be unfrezee user. Please check!</span></div><div class='col-xs-2'><button onclick='deleteUser(\"" +  userSnap1.key + "\")' class='btn'><i class='fa fa-trash'></i></button><i onclick='ready(\"" +  toogleID + "\")' style='margin-top:7px;margin-right:20px' class='fa fa-chevron-down pull-right'></i></div></div><div style='display: none;' id=\"" +  toogleID + "\"><hr></hr><div class='container'><div style='text-align:left' class='fluid-row'><b>E-mail : </b>" + userSnap2.val().email + "<br><b>Vote Count : </b>" + userSnap2.val().UserVoteCount + "<br><button type='button' class='btn2' type='button' onclick='allOneUserElections(\"" +  userSnap1.key + "\")'><i class='fa fa-check'> Ongoing Elections</i></button><button type='button' class='btn3' onclick='notfreeze(\"" +  userSnap1.key + "\")'><i class='fa fa-check'>  Make unFreeze</i></button></div></div></div></li>"
                      }else{
                        list_div.innerHTML += "<li class='list-group-item'><div class='row toggle' id='dropdown-detail' data-toggle='detail'><div onclick='ready(\"" +  toogleID + "\")' style='text-align:left' class='col-xs-10'><b>" + toogleID + "- </b>" + userName.toUpperCase() + "<span id='spanIDUser' class='badge' style='background-color:red'></span></div><div class='col-xs-2'><button onclick='deleteUser(\"" +  userSnap1.key + "\")' class='btn'><i class='fa fa-trash'></i></button><i onclick='ready(\"" +  toogleID + "\")' style='margin-top:7px;margin-right:20px' class='fa fa-chevron-down pull-right'></i></div></div><div style='display: none;' id=\"" +  toogleID + "\"><hr></hr><div class='container'><div style='text-align:left' class='fluid-row'><b>E-mail : </b>" + userSnap2.val().email + "<br><b>Vote Count : </b>" + userSnap2.val().UserVoteCount + "<br><button type='button' class='btn2' onclick='allOneUserElections(\"" +  userSnap1.key + "\")'><i class='fa fa-check'> Ongoing Elections</i></button></div></div></div></li>"
                      }



                });
                });
          }else{
            list_div.innerHTML = "<h3>There is not any user.</h3>"
          }
        showPage();

    });
  }
    getUsers();

    function notfreeze(userKey){
      firebase.database().ref("Kullanıcılar").on("child_added",function(snapshot){
        firebase.database().ref("Kullanıcılar").child(snapshot.key).update({
          Free: "Stable",
          Freeze: false
        });
      });
      alert("Success!");
      timedRefresh(1);

    }

    function makefreeze(userKey){
      firebase.database().ref("Kullanıcılar").on("child_added",function(snapshot){
        firebase.database().ref("Kullanıcılar").child(snapshot.key).update({
          Free: "Stable",
          Freeze: true
        });
      });
      alert("Success!");
      timedRefresh(1);
    }

    function timedRefresh(timeoutPeriod) {
    setTimeout("location.reload(true);",timeoutPeriod); // otomatik refresh.
    }

    function deleteUser(userID){
      if(confirm("Are you sure delete user ?")){
        firebase.database().ref("Kullanıcılar").on("child_added",function(snapshot){
          if(snapshot.key == userID){
            snapshot.ref.remove(function(error){
              alert("User is deleted.");
              timedRefresh(1);
            });
          }
        });
      }
    }

    function allOneUserElections(userID){
      userCount = 0;
      const list_div = document.querySelector("#userLists");
      list_div.innerHTML = ""
      getUserOneElections(userID);
    }

    var userCount1 = 0;
    var names = "";
    function getUserOneElections(userID){
      const list_div = document.querySelector("#userLists");
      document.getElementById("strongName").innerHTML = "Personal elections are below."
      firebase.database().ref("Kullanıcılar").child(userID).child("Elections").on("value",function(snapshotValue){
        var exists = (snapshotValue.val() !== null);
        if(exists){
          firebase.database().ref("Kullanıcılar").child(userID).child("Elections").on("child_added",function(userElec1){
            firebase.database().ref("Elections").on("child_added",function(elecSnap1){
              firebase.database().ref("Elections").child(elecSnap1.key).on("child_added",function(snapshot){
                if(snapshot.key == userElec1.key){
                  console.log("afkjkdja");
                  userCount1 += 1;
                  firebase.database().ref("Kullanıcılar").child(userID).on("value",function(nameSnap){
                    names = nameSnap.val().name + " " + nameSnap.val().surname
                    document.getElementById("nameID").innerHTML = "<div><button class='fa fa-arrow-left'></button>" + names.toUpperCase() + "</div>"
                  });
                  if(userCount1 % 2 == 0){
                    list_div.innerHTML += "<div style='background-color:#eeeaea'><table style='width:100%;' border='1px solid black'><tr>" + userCount1 + "</tr><tr><th>Category</th><th>Election Name</th><th>Ouestion</th><th>Option1</th><th>Option2</th><th>Option3</th></tr><tr><td><b>" + elecSnap1.key + "</b></td><td>" + snapshot.val().ElectionName + "</td><td><b style='color:blue'>" + snapshot.val().Question + "</b></td><td style='text-decoration:underline'>" + snapshot.val().Option1 + "</td><td style='text-decoration:underline'>" + snapshot.val().Option2 + "</td><td style='text-decoration:underline'>" + snapshot.val().Option3 + "</td></tr></table></div>"
                  }else{
                    list_div.innerHTML += "<div style='background-color:#f9f9f9'><table style='width:100%' border='1px solid black'><tr>" + userCount1 + "</tr><tr><th>Category</th><th>Election Name</th><th>Ouestion</th><th>Option1</th><th>Option2</th><th>Option3</th></tr></td><td><b>" + elecSnap1.key + "</b></td><td>" + snapshot.val().ElectionName + "</td><td><b style='color:blue'>" + snapshot.val().Question + "</b></td><td style='text-decoration:underline'>" + snapshot.val().Option1 + "</td><td style='text-decoration:underline'>" + snapshot.val().Option2 + "</td><td style='text-decoration:underline'>" + snapshot.val().Option3 + "</td></tr></table></div>"
                  }
                }
                if(userCount1 == 0){
                    document.getElementById("nameID").innerHTML = "<div><button class='fa fa-arrow-left'></button>There is no election.</div>"
                  //thereIsNoElection();
                }else{
                  document.getElementById("nameID").innerHTML = "<div><button class='fa fa-arrow-left'></button>" + names.toUpperCase() + "</div>"
                  //thereIsNoElection2();
                }
              });
            });
          });
        }else{
          document.getElementById("nameID").innerHTML = "<div><button class='fa fa-arrow-left'></button>There is no election.</div>"
        }
      });


    }

    function showPage() {
      document.getElementById("loader").style.display = "none";
      document.getElementById("myDiv").style.display = "block";
    }

    function showLoading() {
      document.getElementById("loader").style.display = "block";
      document.getElementById("myDiv").style.display = "none";
    }

    function thereIsNoElection2() {
    //  document.getElementById("elecTitle").style.display = "block";
      document.getElementById("thereIsNo").style.display = "none";
    }

    function thereIsNoElection() {
    //  document.getElementById("elecTitle").style.display = "none";
      document.getElementById("thereIsNo").style.display = "block";
    }

    </script>
    <script src="acil.js"></script>

</body>
</html>
